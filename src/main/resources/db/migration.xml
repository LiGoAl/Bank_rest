<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog
        xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
                      https://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-4.31.xsd"
        objectQuotingStrategy="QUOTE_ONLY_RESERVED_WORDS">

    <changeSet id="1" author="LiGoAl">
        <createSequence sequenceName="card_sequence" />
        <createSequence sequenceName="user_sequence" />
        <createSequence sequenceName="request_sequence" />
    </changeSet>

    <changeSet id="2" author="LiGoAl">
        <createTable tableName="card">
            <column name="id" type="BIGINT">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column name="card_number" type="VARCHAR(255)"/>
            <column name="user_id" type="BIGINT"/>
            <column name="expiration_date" type="DATE"/>
            <column name="card_status" type="VARCHAR(20)"/>
            <column name="balance" type="DECIMAL"/>
        </createTable>
    </changeSet>

    <changeSet id="3" author="LiGoAl">
        <createTable tableName="request">
            <column name="id" type="BIGINT">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column name="user_id" type="BIGINT"/>
            <column name="card_id" type="BIGINT"/>
            <column name="request_date" type="DATETIME"/>
            <column name="processed" type="BOOLEAN"/>
        </createTable>
    </changeSet>

    <changeSet id="4" author="LiGoAl">
        <createTable tableName="bank_user">
            <column name="id" type="BIGINT">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column name="username" type="VARCHAR(255)"/>
            <column name="email" type="VARCHAR(255)"/>
            <column name="password" type="VARCHAR(255)"/>
            <column name="roles" type="VARCHAR(255)"/>
        </createTable>
    </changeSet>

    <changeSet id="5" author="LiGoAl">
        <addForeignKeyConstraint baseColumnNames="user_id" baseTableName="card" constraintName="FK_CARD_ON_USER"
                                 referencedColumnNames="id" referencedTableName="bank_user"/>
        <addForeignKeyConstraint baseColumnNames="card_id" baseTableName="request" constraintName="FK_REQUEST_ON_CARD"
                                 referencedColumnNames="id" referencedTableName="card"/>
        <addForeignKeyConstraint baseColumnNames="user_id" baseTableName="request" constraintName="FK_REQUEST_ON_USER"
                                 referencedColumnNames="id" referencedTableName="bank_user"/>
    </changeSet>

    <changeSet id="6" author="LiGoAl">
        <insert tableName="bank_user">
            <column name="id" valueSequenceNext="user_sequence" />
            <column name="username" value="admin1" />
            <column name="password" value="$2a$04$MFDyXiZ/7QM0qNmworpK6.yibQs04WykPlLNBK/b5K2DiBIc3yiNW" />
            <column name="email" value="admin1@gmail.com" />
            <column name="roles" value="ROLE_ADMIN,ROLE_USER" />
        </insert>
        <insert tableName="bank_user">
            <column name="id" valueSequenceNext="user_sequence" />
            <column name="username" value="user1" />
            <column name="email" value="user1@gmail.com" />
            <column name="password" value="$2a$04$zx92KEHV4Z9fYI.tSHXc7Op.jeJewe4I9Io7Dm2ZNDpkr2t9lJxrK" />
            <column name="roles" value="ROLE_USER" />
        </insert>
        <insert tableName="bank_user">
            <column name="id" valueSequenceNext="user_sequence" />
            <column name="username" value="user2" />
            <column name="email" value="user2@mail.ru" />
            <column name="password" value="$2a$05$uCYrBa8OmRMGPe47oXmmrO3megNIOicWk5MqafkHlZ5diZZFHvJT6" />
            <column name="roles" value="ROLE_USER" />
        </insert>
    </changeSet>

    <changeSet id="7" author="LiGoAl">
        <insert tableName="card">
            <column name="id" valueSequenceNext="card_sequence" />
            <column name="card_number" value="1234 1234 1234 5678" />
            <column name="user_id" value="2" />
            <column name="expiration_date" value="2030-01-01" />
            <column name="card_status" value="ACTIVE" />
            <column name="balance" value="10000.63" />
        </insert>
        <insert tableName="card">
            <column name="id" valueSequenceNext="card_sequence" />
            <column name="card_number" value="1234 1234 1234 8765" />
            <column name="user_id" value="2" />
            <column name="expiration_date" value="2029-01-01" />
            <column name="card_status" value="ACTIVE" />
            <column name="balance" value="1000.78" />
        </insert>
        <insert tableName="card">
            <column name="id" valueSequenceNext="card_sequence" />
            <column name="card_number" value="1234 1234 1234 1234" />
            <column name="user_id" value="3" />
            <column name="expiration_date" value="2030-05-02" />
            <column name="card_status" value="ACTIVE" />
            <column name="balance" value="100000.64" />
        </insert>
        <insert tableName="card">
            <column name="id" valueSequenceNext="card_sequence" />
            <column name="card_number" value="1234 1234 1234 4321" />
            <column name="user_id" value="3" />
            <column name="expiration_date" value="2031-01-07" />
            <column name="card_status" value="ACTIVE" />
            <column name="balance" value="598.71" />
        </insert>
    </changeSet>

</databaseChangeLog>