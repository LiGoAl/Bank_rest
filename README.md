# Banking Card Management System

Приложение для управления банковскими картами. Позволяет пользователям создавать, блокировать, активировать и удалять карты, управлять своими финансами и безопасно переводить средства между своими карточками. Также позволяет администраторам создавать, просматривать, обновлять и удалять пользователей.

## Содержание

- [Описание](#описание)
- [Установка](#установка)
- [Использование](#использование)
- [API](#api)
- [Тестирование](#тестирование)
- [Документация](#документация)
- [Развёртывание с помощью Docker](#развертывание-с-помощью-docker)
- [Технологии](#технологии)

## Описание

Это приложение предоставляет функциональность для:

Администратор:
- Создаёт, блокирует, активирует, удаляет карты
- Управляет пользователями
- Видит все карты

Пользователь:
- Просматривает свои карты (поиск + пагинация)
- Запрашивает блокировку карты
- Делает переводы между своими картами
- Смотрит баланс

### Атрибуты карты

- Идентификационный номер (уникальный номер в базе данных)
- Номер карты (зашифрован, отображается маской: **** **** **** 1234)
- Владелец (пользователь)
- Срок действия
- Статус: активна, заблокирована, истек срок
- Баланс

### Атрибуты пользователя (или администратора)

- Идентификационный номер (уникальный номер в базе данных)
- Имя пользователя
- Электронная почта
- Пароль (захеширован)
- Роли/Роль: админ, пользователь
- Список карт пользователя

### Атрибуты запроса на блокировку карты

- Идентификационный номер (уникальный номер в базе данных)
- Пользователь
- Карта
- Дата и время подачи запроса
- Статус: обработан, не обработан

## Установка

1. Клонируйте репозиторий:
   ```bash
   git clone https://github.com/ваш-пользователь/banking-card-management-system.git
2. Перейдите в директорию проекта:
   ```bash
   cd banking-card-management-system
3. Убедитесь, что у вас установлен Java (версии 21 или выше):
   ```bash
   java -version
4. Убедитесь, что у вас установлен Docker и Docker Compose.
5. Настройте файл application.properties для подключения к базе данных.
6. Запустите приложение с помощью команд:
   ```bash
   ./mvnw spring-boot:run
   ```
   Или с помощью Docker:
   ```bash
   docker-compose up
   ```

## Использование

Приложение запускается на локальном сервере по умолчанию на порту 8080. Откройте браузер и перейдите на http://localhost:8080 для доступа к API и Swagger UI.

### Примеры обращения к API

- Аутентификация
   ```http request
   POST /auth/sign-in
   ```
   Запрос:
   ```json
   {
    "email": "user1@gmail.com",
    "password": "123456789"
   }
   ```
- Получение всех карт (нужны админские права)
   ```http request
   GET /cards
   ```
- Получение пользователем всех своих карт
   ```http request
   GET /user_cards
   ```

## API

### Пользователи

- **POST /auth/sign-in** - Аутентификация пользователя
- **POST /auth/refresh** - Обновление токена с помощью рефреш токена
- **GET /user_cards** - Получение пользователем всех своих карт
- **GET /user_cards/card** - Получение конкретной карты пользователя по идентификационному номеру
- **POST /user_cards/transfer** - Перевод денег с одной карты пользователя на другую
- **POST /user_cards/block** - Запрос на блокировку карты по идентификационному номеру

### Администраторы

- **GET /cards** - Получение всех карт
- **POST /cards** - Создание новой карты
- **DELETE /cards** - Удаление карты
- **PUT /cards** - Обновление данных карты
- **GET /users** - Получение всех пользователей
- **POST /users** - Создание нового пользователя
- **DELETE /users** - Удаление пользователя
- **PUT /users** - Обновление данных пользователя
- **GET /user_cards/block-requests** - Получение всех не обработанных запросов на блокировки карт
- **POST /user_cards/block-requests** - Блокировка карты по идентификационному номеру запроса

## Тестирование
1. Убедитесь, что сервер запущен.
2. Запустите тесты командой:
    ```bash
    ./mvnw test
    ```
## Документация

Документация по API доступна через Swagger UI по адресу:

- http://localhost:8080/swagger-ui/index.html

Сгенерированная документация в формате OpenAPI также доступна по адресу:

- docs/openapi.yaml

## Развертывание с помощью Docker

Для простоты развертывания и тестирования используйте Docker Compose. Просто выполните команду:
```bash
  docker-compose up
```
Это создаст контейнеры для вашего приложения и базы данных.

## Технологии

- Java 21+
- Spring Boot
- Spring Security
- Spring Data JPA
- PostgreSQL
- Liquibase
- Docker
- JWT
- Swagger(OpenAPI)